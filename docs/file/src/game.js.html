<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/game.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/woobloo/woobloo-frontend" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-STAGE_HEIGHT">STAGE_HEIGHT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-STAGE_WIDTH">STAGE_WIDTH</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Components/Map.js~Map.html">Map</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Components/Tile.js~Tile.html">Tile</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">core</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/GameServer.js~GameServer.html">GameServer</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/game.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { STAGE_WIDTH, STAGE_HEIGHT } from &apos;./config.js&apos;

import Tile from &apos;./Components/Tile.js&apos;
import Map from &apos;./Components/Map.js&apos;

var game = new Phaser.Game(STAGE_WIDTH, STAGE_HEIGHT, Phaser.AUTO, &apos;test&apos;, null, true, false);
var Woobloo = function (game) { };
Woobloo.Boot = function (game) { };

var isoGroup, cursorPos, cursor, arrowKeys, infoPanel, hud;

Woobloo.Boot.prototype =
{
    init: function(setup_data){

      if(setup_data == undefined){
        this._players = [];
        this._map = Map.createGrassMap();
      } else {
        const {Players, Map} = setup_data;
        this._players = Players;
        this._map = Map;
      }

      this._world_width = this._map.width * Tile.SIDE * 1.9;
      this._world_height = this._map.height * Tile.SIDE;
    },

    getRandomInt: function(min, max) {
      return Math.floor(Math.random() * (max - min)) + min;
    },

    preload: function () {
        // Add and enable the isometric plug-in.
        game.plugins.add(new Phaser.Plugin.Isometric(game));
        // This is used to set a game canvas-based offset for the 0, 0, 0 isometric coordinate - by default
        // this point would be at screen coordinates 0, 0 (top left) which is usually undesirable.
        game.iso.anchor.setTo(0.5, 0.04);

        game.time.advancedTiming = true;

        game.load.image(&quot;tile_info_bg&quot;, &quot;images/tile_info.png&quot;);
        this._map.preload(game);
    },

    renderHUD: function() {
      hud = game.add.group();
      infoPanel = game.add.text(STAGE_WIDTH - 200, STAGE_HEIGHT - 50, &quot;Test HUD&quot;);
      // hud.addChild(game.add.rectangle(STAGE_WIDTH - 100, STAGE_HEIGHT - 200, 100, 200));
      hud.addChild(infoPanel);

      hud.fixedToCamera = true;

      // game.add.image(0, 0, &quot;grass&quot;)
    },
    create: function () {

        game.world.setBounds(0, 0, this._world_width, this._world_height);
        game.camera.x = (this._world_width)/2 - STAGE_WIDTH/2;
        game.camera.y = (this._world_height)/2 - STAGE_HEIGHT/2;

        // Create a group for our tiles.
        isoGroup = game.add.group();

        // Let&apos;s make a load of tiles on a grid.
        this.spawnTiles();

        // Provide a 3D position for the cursor
        cursorPos = new Phaser.Plugin.Isometric.Point3();

        arrowKeys = game.input.keyboard.createCursorKeys();

        this.renderHUD();
    },
    update: function () {
        // Update the cursor position.
        // It&apos;s important to understand that screen-to-isometric projection means you have to specify a z position manually, as this cannot be easily
        // determined from the 2D pointer position without extra trickery. By default, the z position is 0 if not set.
        game.iso.unproject(game.input.activePointer.position, cursorPos);

        // Loop through all tiles and test to see if the 3D position from above intersects with the automatically generated IsoSprite tile bounds.
        isoGroup.forEach(function (tile) {
            var inBounds = tile.isoBounds.containsXY(cursorPos.x, cursorPos.y);
            // If it does, do a little animation and tint change.
            if (!tile.selected &amp;&amp; inBounds) {
                tile.selected = true;
                tile.tint = 0x86bfda;
                // console.log(tile);

                tile.infoPanel = game.add.image(tile.x, tile.y, &quot;tile_info_bg&quot;)
                tile.infoPanel.anchor = new Phaser.Point(0, 1);
                tile.infoPanel.visible = false
                setTimeout(() =&gt; {
                  // tile.infoPanel = game.add.image(tile.x, tile.y, &quot;tile_info_bg&quot;)
                  if(tile.selected)
                    tile.infoPanel.visible = true
                }, 1000);
                // game.add.image();

                // game.add.tween(tile).to({ isoZ: 4 }, 200, Phaser.Easing.Quadratic.InOut, true);
            }
            // If not, revert back to how it was.
            else if (tile.selected &amp;&amp; !inBounds) {
                tile.selected = false;
                tile.tint = 0xffffff;

                if(tile.infoPanel)
                  tile.infoPanel.kill()

                // game.add.tween(tile).to({ isoZ: 0 }, 200, Phaser.Easing.Quadratic.InOut, true);
            }
        });

        if (arrowKeys.up.isDown)
         {
             game.camera.y -= 4;
         }
         else if (arrowKeys.down.isDown)
         {
             game.camera.y += 4;
         }

         if (arrowKeys.left.isDown)
         {
             game.camera.x -= 4;
         }
         else if (arrowKeys.right.isDown)
         {
             game.camera.x += 4;
         }

         if(game.input.mousePointer.x &lt;= STAGE_WIDTH*0.02 ){
            game.camera.x -= 8;
         } else if (game.input.mousePointer.x &gt;= STAGE_WIDTH*0.98) {
            game.camera.x += 8;
         }

         if(game.input.mousePointer.y &lt;= STAGE_HEIGHT*0.02 ){
            game.camera.y -= 8;
         } else if (game.input.mousePointer.y &gt;= STAGE_HEIGHT*0.98) {
            game.camera.y += 8;
         }
    },
    render: function () {
        game.debug.text(`FPS: ${game.time.fps}` || &apos;--&apos;, 4, 20, &quot;#bbb&quot;);
        game.debug.cameraInfo(game.camera, 32, 32);
    },
    spawnTiles: function () {
        var tile;
        for (var xx = 0; xx &lt; this._map.height; xx ++) {
            for (var yy = 0; yy &lt; this._map.width; yy ++) {
                // Create a tile using the new game.add.isoSprite factory method at the specified position.
                // The last parameter is the group you want to add it to (just like game.add.sprite)
                let tileData = this._map._map[xx][yy];
                tile = game.add.isoSprite(tileData.pos.x*Tile.SIDE, tileData.pos.y*Tile.SIDE, 0, &quot;grass&quot;, 0, isoGroup);
                tile.anchor.set(0.5, 0);
            }
        }
    }
};

game.state.add(&apos;Boot&apos;, Woobloo.Boot);

export default game;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.7)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
